var Focus=function(){var a={models:[],binderInstances:[]},b=a.ajax=function(a){var b=a.method.toUpperCase()||"GET",c=a.url,d=a.onSuccess||function(){},e=a.onFailure||function(){};"GET"===b&&a.data&&(c=c+"?"+a.data,delete a.data);var f=new XMLHttpRequest;if(f.open(b,c,!0),a.contentType&&f.setRequestHeader("Content-type",a.contentType),a.onProgress&&"function"==typeof a.onProgress){var g=function(b){a.onProgress(b)};f.addEventListener("progress",g)}f.onreadystatechange=function(){if(4==f.readyState){if(g&&f.removeEventListener("progress",g),200!=f.status)e(f);else if(200==f.status)return d(f,JSON.parse(f.responseText)),!0;return!1}},f.send(a.data)},c=a.extend=function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]},d=(a.proxy=function(a,b){var c=[].slice.call(arguments,2);return function(){return a.apply(b||this,c.concat([].slice.call(arguments)))}},function(){this.regex={alphanumeric:/^[a-zA-Z0-9áàâäãåçéèêëíìîïñóòôöõúùûüýÿæœÁÀÂÄÃÅÇÉÈÊËÍÌÎÏÑÓÒÔÖÕÚÙÛÜÝŸÆŒ._\s-]+$/,numeric:/^\d+$/,alpha:/^[a-zA-ZÁÀÂÃÄÉÈËÍÌÎÏÓÒÔÚÙáàãâéèíìîóòúùûü]+$/,email:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/}});d.prototype={set:function(a){for(var b in a)if(!a[b]instanceof RegExp)return!1;return c(this.regex,a),this},validate:function(a,b){if(this.regex[a])return this.regex[a].test(b);if(a instanceof RegExp)return a.test(b);throw new Error("Validator->validate() requires a regex of a valid check type as parameter and a value")}};var e;a.Validator=function(){return e||(e=new d),e};var f,g=function(){this.actions=[]};g.prototype={register:function(a,b,c){if("function"!=typeof b)throw new Error("Dispatcher-> register() requires both string and callback");this.actions[a]?this.actions[a].push({scope:c,callback:b}):this.actions[a]=[{scope:c,callback:b}]},unregister:function(a,b){if(!this.actions[a])throw new Error("Dispatcher->"+a+" is undefined");b||(this.actions[a]=[]);var c=this.actions[a].indexOf(b);c>-1&&this.actions[a].splice(c,1)},dispatch:function(a,b){this.actions[a]&&this.actions[a].forEach(function(a){"function"==typeof a.callback&&(a.scope?a.callback.call(a.scope,b):a.callback(b))})},list:function(a){console.log("Dispatcher->"+a+"-> Callbacks :"),this.actions[a].forEach(function(a){console.log(a.callback)})}},a.Dispatcher=function(){return f||(f=new g),f};var h,i=function(b,c){a.Dispatcher().dispatch(b,c)},j=function(b,c,d){return this._actions[b]||(this._actions[b]=[]),this._actions[b].push({scope:d,callback:c}),a.Dispatcher().register(b,c,d),this},k=function(){if(f){for(_key in this._actions)this._actions[_key].forEach(function(a){f.unregister(_key,a)});return!0}return!1},l=function(){this.routes={}};l.prototype={silentRoute:null,addRoute:function(a,b,c,d){this.routes[a]={callback:b,scope:c,listening:d},d&&this.listen(a)},setRoute:function(a,b){var c=this.splitRoute(a),d=this.routes[c.base];return d&&(d.listening&&b&&(this.silentRoute=c.base),window.location.hash=a,d.listening||b||(c.options.unshift(c.base),d.callback.apply(d.scope,c.options))),d},setFromHash:function(){var a=this.splitRoute(window.location.hash);this.routes[a.base]&&(a.options.unshift(a.base),this.routes[a.base].callback.apply(this.routes[a.base].scope,a.options))},listen:function(a){var b,c=this;window.onhashchange=function(d){b=c.splitRoute(d.newURL.split("#")[1]),c.silentRoute!==a?c.routes[b.base]&&c.routes[b.base].listening&&(b.options.unshift(b.base),c.routes[b.base].callback.apply(c.routes[b.base].scope,b.options)):c.silentRoute=null}},splitRoute:function(a){var b=a.replace("#","").split("/");return{base:b.shift(),options:b}}},a.Router=function(){return h||(h=new l),h};var m=function(d,e){var f=function(a){for(var b in e)"function"==typeof e[b]?f.prototype[b]=e[b]:f[b]=e[b];this.name=d,this._actions={},this.attributes={},this.set(a),this.init()};return f.prototype={init:function(){},set:function(a){return"object"==typeof a?c(this.attributes,a):"string"==typeof a&&arguments.length>1&&(this.attributes[a]=arguments[1]),this.attributes},get:function(a){return a?this.attributes[a]:this.attributes},has:function(a){return"undefined"!=typeof this.attributes[a]},attributeIs:function(b,c){var d=a.Validator();return d.validate(c,this.attributes[b])},request:function(a){return b(a),this},destroy:function(){k()},dispatch:i,onDispatch:j},a.models[d]=f,f};a.Model=m;var n=(a.Collection=function(d){var e=function(){if(!d.model||!a.models[d.model])throw new Error("Collection->model must be a valid Focus.Model");var e=new Array;c(e,d);var f=function(a,b,c){for(var d=[],f=0,g=e.length;g>f;++f)e[f].attributes[a]===b&&d.push(c?e[f]:f);return d},g={push:function(){for(var b=0,c=arguments.length;c>b;++b)if(!arguments[b]instanceof a.models[d.model])throw new Error("Collection->push must provide valid Focus.Models");return Array.prototype.push.apply(this,arguments)},sortBy:function(a,b){return e[0]?("string"==typeof e[0].attributes[a]?e.sort(function(b,c){return b.attributes[a]<c.attributes[a]?-1:b.attributes[a]>c.attributes[a]?1:0}):parseInt(e[0].attributes[a])&&e.sort(function(b,c){return b.attributes[a]-c.attributes[a]}),"<"===b?this:e.reverse()):this},getWhere:function(a,b){return f(a,b,!0)},setWhere:function(a,b,c,d){"undefined"==typeof d&&(d=c,c=a);var e=f(a,b,!0);return e.forEach(function(a){a.set(c,d)}),e},deleteWhere:function(a,b){return"index"===a?(e[b].destroy(),e.splice(b,1)):f(a,b).forEach(function(a){e[a].destroy(),e.splice(a,1)}),this},request:function(a){return b(a),this},toJSON:function(){var a=[];return e.forEach(function(b){a.push(b.get())}),a},dispatch:i,onDispatch:j};return c(e,g),d.values&&e.push.apply(this,d.values),e};return e},function(b,c){for(var d in c)this[d]=c[d];this.binderName=b,a.binderInstances[b]=this});return n.prototype={bindToView:function(a,b,c){var d=this;if("object"!=typeof a)throw new Error("Binder->bindToView() requires a view object to which functions will be bound");return b.forEach(function(b){if("function"!=typeof d[b])throw new Error("Binder->bindToView() requires an array of functions associated with a view, "+b+" is not a valid method of binder instance");a[b]=c?d[b].bind(c):d[b].bind(a)}),a.binderName=this.binderName,a._=this._,a},_:function(b,c){if("function"!=typeof a.binderInstances[this.binderName][b])throw new Error("Binder->_() requires a valid Binder method to be called");"object"==typeof c&&c.length||(c=[c]),a.binderInstances[this.binderName][b].apply(this,c)}},a.Binder=function(b,c){return function(d,e){return a.binderInstances[b]||new n(b,c),a.binderInstances[b].bindToView(d,e),"function"==typeof a.binderInstances[b].init&&a.binderInstances[b].init.call(d),d}},a}();