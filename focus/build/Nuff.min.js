var Nuff=function(){var a={models:[],presenterInstances:[]},b=a.ajax=function(a){var b=a.method.toUpperCase()||"GET",c=a.url,d=a.onSuccess||function(){},e=a.onFailure||function(){};"GET"===b&&a.data&&(c=c+"?"+a.data,delete a.data);var f=new XMLHttpRequest;if(f.open(b,c,!0),a.contentType&&f.setRequestHeader("Content-type",a.contentType),a.onProgress&&"function"==typeof a.onProgress){var g=function(b){a.onProgress(b)};f.addEventListener("progress",g)}f.onreadystatechange=function(){if(4==f.readyState){if(g&&f.removeEventListener("progress",g),200!=f.status)e(f);else if(200==f.status)return d(f,JSON.parse(f.responseText)),!0;return!1}},f.send(a.data)},c=a.extend=function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]},d=(a.proxy=function(a,b){var c=[].slice.call(arguments,2);return function(){return a.apply(b||this,c.concat([].slice.call(arguments)))}},function(){this.regex={alphanumeric:/^[a-zA-Z0-9áàâäãåçéèêëíìîïñóòôöõúùûüýÿæœÁÀÂÄÃÅÇÉÈÊËÍÌÎÏÑÓÒÔÖÕÚÙÛÜÝŸÆŒ._\s-]+$/,numeric:/^\d+$/,alpha:/^[a-zA-ZÁÀÂÃÄÉÈËÍÌÎÏÓÒÔÚÙáàãâéèíìîóòúùûü]+$/,email:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/}});d.prototype={set:function(a){for(var b in a)if(!a[b]instanceof RegExp)return!1;return c(this.regex,a),this},validate:function(a,b){if(this.regex[a])return this.regex[a].test(b);if(a instanceof RegExp)return a.test(b);throw new Error("Validator->validate() requires a regex of a valid check type as parameter and a value")}};var e;a.Validator=function(){return e||(e=new d),e};var f,g=function(){this.actions=[]};g.prototype={register:function(a,b,c){if("function"!=typeof b)throw new Error("Dispatcher-> register() requires both string and callback");this.actions[a]?this.actions[a].push({scope:c,callback:b}):this.actions[a]=[{scope:c,callback:b}]},unregister:function(a,b){if(!this.actions[a])throw new Error("Dispatcher->"+a+" is undefined");b||(this.actions[a]=[]);var c=this.actions[a].indexOf(b);c>-1&&this.actions[a].splice(c,1)},dispatch:function(a,b){this.actions[a]&&this.actions[a].forEach(function(a){"function"==typeof a.callback&&(a.scope?a.callback.call(a.scope,b):a.callback(b))})},list:function(a){console.log("Dispatcher->"+a+"-> Callbacks :"),this.actions[a].forEach(function(a){console.log(a.callback)})}},a.Dispatcher=function(){return f||(f=new g),f};var h,i=function(b,c){a.Dispatcher().dispatch(b,c)},j=function(b,c,d){return this._actions[b]||(this._actions[b]=[]),this._actions[b].push({scope:d,callback:c}),a.Dispatcher().register(b,c,d),this},k=function(){if(f){for(_key in this._actions)this._actions[_key].forEach(function(a){f.unregister(_key,a)});return!0}return!1},l=function(){this.routes=[],this.eventListeners=[]};l.prototype={register:function(a,b,c,d){if(a&&"function"==typeof b){if(this.routes[a])throw new Error("Router-register() "+a+" route is already defined");return this.routes[a]={callback:b,scope:c||this},d&&this.listen(a),this}throw new Error("Router->register() requires a string and a callback function")},listen:function(a){var b=this,c=a.split("/").shift();this.eventListeners.push(function(){var a=window.location.hash.replace("#","");a.split("/").shift()===c&&b.setRoute(a)});var d=this.eventListeners.length-1;this.routes[c].listenerIndex=d,window.addEventListener("hashchange",this.eventListeners[d])},removeListener:function(a){var b=this.routes[a].listenerIndex;window.removeEventListener("hashchange",this.eventListeners[b]),this.eventListeners.splice(b,1)},unregister:function(a){return delete this.routes[a],this},setRoute:function(a,b){window.location.hash=a;var c=a.split("/");if(a=c[0],this.routes[a])return b||this.routes[a].callback.apply(this.routes[a].scope,c),this;throw new Error("Router->setRoute() "+a+" is undefined")},setFromHash:function(a){var b=window.location.hash.replace("#",""),c=b.split("/")[0];this.routes[c]?this.setRoute(b):a&&this.setRoute(a)}},a.Router=function(){return h||(h=new l),h};var m=function(d,e){var f=function(a){for(var b in e)"function"==typeof e[b]?f.prototype[b]=e[b]:f[b]=e[b];this.name=d,this._actions={},this.attributes={},this.set(a),this.init()};return f.prototype={init:function(){},set:function(a){return"object"==typeof a?c(this.attributes,a):"string"==typeof a&&arguments.length>1&&(this.attributes[a]=arguments[1]),this.attributes},get:function(a){return a?this.attributes[a]:this.attributes},has:function(a){return"undefined"!=typeof this.attributes[a]},attributeIs:function(b,c){var d=a.Validator();return d.validate(c,this.attributes[b])},request:function(a){return b(a),this},destroy:function(){k()},dispatch:i,onDispatch:j},a.models[d]=f,f};a.Model=m;var n=(a.Collection=function(d){var e=function(){if(!d.model||!a.models[d.model])throw new Error("Collection->model must be a valid Nuff.Model");var e=new Array;c(e,d);var f=function(a,b,c){for(var d=[],f=0,g=e.length;g>f;++f)e[f].attributes[a]===b&&d.push(c?e[f]:f);return d},g={push:function(){for(var b=0,c=arguments.length;c>b;++b)if(!arguments[b]instanceof a.models[d.model])throw new Error("Collection->push must provide valid Nuff.Models");return Array.prototype.push.apply(this,arguments)},sortBy:function(a,b){return e[0]?("string"==typeof e[0].attributes[a]?e.sort(function(b,c){return b.attributes[a]<c.attributes[a]?-1:b.attributes[a]>c.attributes[a]?1:0}):parseInt(e[0].attributes[a])&&e.sort(function(b,c){return b.attributes[a]-c.attributes[a]}),"<"===b?this:e.reverse()):this},getWhere:function(a,b){return f(a,b,!0)},setWhere:function(a,b,c,d){"undefined"==typeof d&&(d=c,c=a);var e=f(a,b,!0);return e.forEach(function(a){a.set(c,d)}),e},deleteWhere:function(a,b){return"index"===a?(e[b].destroy(),e.splice(b,1)):f(a,b).forEach(function(a){e[a].destroy(),e.splice(a,1)}),this},request:function(a){return b(a),this},toJSON:function(){var a=[];return e.forEach(function(b){a.push(b.get())}),a},dispatch:i,onDispatch:j};return c(e,g),d.values&&e.push.apply(this,d.values),e};return e},function(b,c){var d=function(e){for(var f in c)"function"==typeof c[f]?d.prototype[f]=c[f]:d[f]=c[f];this.presenterName=b,a.presenterInstances[b]=this,this._actions={},this._init(e)};return d.prototype={_init:function(a){return this.destroy(),"object"==typeof a&&a.presenterMethods&&this.bindMethodsToView(a,a.presenterMethods),this.init(a),this},init:function(a){},bindMethodsToView:function(a,b){return a&&this.mapViewFunctions(a,b,a.presenterMethodsScope||this),this},mapViewFunctions:function(a,b,c){var d=this;return b.forEach(function(b){if("function"!=typeof d[b])throw new Error("Presenter->mapViewFunctions() requires an array of functions associated with a view, "+b+" is not a valid method of presenter instance");a[b]=c?d[b].bind(c):d[b]}),a},destroy:function(){return k()},dispatch:i,onDispatch:j},c&&"undefined"!=typeof c.singleton&&!c.singleton?d:function(c){return a.presenterInstances[b]?a.presenterInstances[b]._init(c):new d(c)}});return a.Presenter=n,a}();